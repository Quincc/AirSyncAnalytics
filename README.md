# üìå –ü—Ä–æ–µ–∫—Ç: ETL-–ø–∞–π–ø–ª–∞–π–Ω —Å Apache Airflow, PostgreSQL –∏ MongoDB

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **ETL-–ø—Ä–æ—Ü–µ—Å—Å**, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é **Apache Airflow**, **PostgreSQL** –∏ **MongoDB**. –í —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ **—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –∏–∑ MongoDB –≤ PostgreSQL, –∞ —Ç–∞–∫–∂–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–∏—Ç—Ä–∏–Ω—ã** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

---
## üõ† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Apache Airflow** ‚Äì –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ ETL-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
- **MongoDB** ‚Äì —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (NoSQL).
- **PostgreSQL** ‚Äì –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- **Python** ‚Äì –Ω–∞–ø–∏—Å–∞–Ω–∏–µ DAGs –¥–ª—è Airflow.
- **Docker (–ø–æ –∂–µ–ª–∞–Ω–∏—é)** ‚Äì —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---
## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
üìÅ airflow/
 ‚îú‚îÄ‚îÄ dags/
 ‚îÇ   ‚îú‚îÄ‚îÄ replication_dag.py        # DAG –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ MongoDB –≤ PostgreSQL
 ‚îÇ   ‚îú‚îÄ‚îÄ update_analytics_dag.py   # DAG –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω
üìÅ database/
 ‚îú‚îÄ‚îÄ schema_postgres.sql           # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ PostgreSQL
 ‚îú‚îÄ‚îÄ create_showcases_postgres.sql # –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω –≤ PostgreSQL
üìÅ scripts/
 ‚îú‚îÄ‚îÄ data_generation.py            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
üìÅ docs/
 ‚îú‚îÄ‚îÄ README.md                     # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---
## üìù –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### **1Ô∏è‚É£ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
- –°–æ–∑–¥–∞—é—Ç—Å—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ **MongoDB**:
  - `UserSessions` ‚Äì —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
  - `ProductPriceHistory` ‚Äì –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω.
  - `EventLogs` ‚Äì –ª–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π.
  - `SupportTickets` ‚Äì –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.
  - `UserRecommendations` ‚Äì —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
  - `ModerationQueue` ‚Äì –º–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤.
  - `SearchQueries` ‚Äì –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

üîπ **–§–∞–π–ª**:
- `data_generation.py` ‚Äì –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### **2Ô∏è‚É£ –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL**
- –î–∞–Ω–Ω—ã–µ –∏–∑ **MongoDB** –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ **PostgreSQL** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Airflow DAG (`replication_dag.py`)**.
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è:
  - `ObjectId` ‚Üí `string`
  - `datetime` ‚Üí `ISO 8601`
  - `lists` ‚Üí `PostgreSQL ARRAY`

üîπ **–§–∞–π–ª**: `replication_dag.py`

### **3Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω**
- –í–∏—Ç—Ä–∏–Ω–∞ **`user_activity_summary`** ‚Äì –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- –í–∏—Ç—Ä–∏–Ω–∞ **`support_performance`** ‚Äì –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏.
- DAG **`update_analytics_dag.py`** –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.

üîπ **–§–∞–π–ª**: `update_analytics_dag.py`
üîπ **SQL**:
- `create_showcases_postgres.sql` ‚Äì —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω.

---
## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
### **1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```bash
pip install -r requirements.txt
```

### **2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ Airflow**
```bash
export AIRFLOW_HOME=~/airflow
airflow db init
airflow scheduler &
airflow webserver -p 8080 &
```

### **3Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤**
–ü–µ—Ä–µ–π—Ç–∏ –≤ **Airflow UI** (`http://localhost:8080`):
- –ó–∞–ø—É—Å—Ç–∏—Ç—å `replication_dag`
- –ó–∞–ø—É—Å—Ç–∏—Ç—å `update_analytics_dag`

---
## üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
- **–¢–û–ü-5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
  ```sql
  SELECT user_id, total_sessions, total_pages_visited, total_actions
  FROM user_activity_summary
  ORDER BY total_sessions DESC
  LIMIT 5;
  ```
- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤:**
  ```sql
  SELECT AVG(avg_resolution_time) AS avg_ticket_time FROM support_performance;
  ```

---
## üìå –û—Ü–µ–Ω–æ—á–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
‚úÖ –†–∞–∑–≤—ë—Ä–Ω—É—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (MongoDB, PostgreSQL)
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é Airflow
‚úÖ –î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã –∏ –ø–æ–¥–¥–∞—é—Ç—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω—ã –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–∏—Ç—Ä–∏–Ω—ã
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã DAGs –≤ Airflow
‚úÖ –û–ø–∏—Å–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---
## üèÜ –ò—Ç–æ–≥
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π ETL-–∫–æ–Ω–≤–µ–π–µ—Ä**, –∫–æ—Ç–æ—Ä—ã–π **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–±–æ—Ä, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö**.

üöÄ **–ì–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é!**

